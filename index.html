<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order a queue</title>
</head>
<body>
<form id="form" onsubmit="submitHandler(event)">
    <p><select>
        <option disabled>Select option</option>
        <option selected value="Get teudat zehut">Get teudat zehut</option>
    </select></p>
    <p><input type="text" name="teudat" placeholder="teudat zehut number" value="346316136"></p>
    <p><input type="text" name="phone" placeholder="phone number" value="0538535491"></p>
    <p><input type="text" name="address" value="שדרות פל ים"></p>
    <p><input type="submit" value="Order visit"></p>
</form>
<h1 hidden id="loading">Loading</h1>
<script>
    const socket = new WebSocket('ws://localhost:5000/');

    socket.onopen = () => {
        console.log('Connected to the ws server')
    }

    let dateSelect;
    socket.onmessage = (event, () => {
        console.log(event.data)
        let data = JSON.parse(event.data);
        if (data[0].date) {
            console.log(data);
            dateSelect = document.createElement("select");
            for (let i = 0; i < data.length; i++) {
                let option = document.createElement("option");
                const date = new Date(data[i].date);
                option.value = data[i].selector;
                ;
                const textContent = document.createTextNode(`${date.getDate()}.${date.getMonth()}.${date.getFullYear()}`)
                option.appendChild(textContent);
                dateSelect.appendChild(option);
            }
            document.body.append(dateSelect);
        }
    })

    // dateSelect.onchange(() => {
    //     socket.send(dateSelect.value)
    // })


    const loading = document.getElementById('loading');

    const submitHandler = async (event) => {
        event.preventDefault();
        let data = {
            teudat: event.target[1].value,
            phone: event.target[2].value,
            address: event.target[3].value
        }
        event.target[4].disabled = true;
        loading.hidden = false;
        socket.send(JSON.stringify(data));

    }
</script>
</body>
</html>